<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FORTRESS // DEV vs ATTACKER CTF</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
<style>
  :root {
    --neon-green: #00ff88;
    --neon-red: #ff003c;
    --neon-blue: #00d4ff;
    --neon-yellow: #ffe600;
    --bg-dark: #020408;
    --bg-panel: rgba(0,255,136,0.04);
    --border: rgba(0,255,136,0.2);
    --text: #c8ffd4;
    --dim: #4a7a5a;
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  body {
    background: var(--bg-dark);
    font-family: 'Share Tech Mono', monospace;
    min-height: 100vh;
    overflow: hidden;
    color: var(--text);
    cursor: crosshair;
  }

  /* Matrix rain canvas */
  #matrix-canvas {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    z-index: 0;
    opacity: 0.12;
  }

  /* Scanlines overlay */
  body::after {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: repeating-linear-gradient(
      0deg,
      transparent,
      transparent 2px,
      rgba(0,0,0,0.08) 2px,
      rgba(0,0,0,0.08) 4px
    );
    pointer-events: none;
    z-index: 9999;
  }

  .vignette {
    position: fixed;
    top: 0; left: 0;
    width: 100%; height: 100%;
    background: radial-gradient(ellipse at center, transparent 40%, rgba(0,0,0,0.8) 100%);
    pointer-events: none;
    z-index: 1;
  }

  /* HUD corners */
  .hud-corner {
    position: fixed;
    width: 60px; height: 60px;
    z-index: 10;
    opacity: 0.5;
  }
  .hud-corner.tl { top: 20px; left: 20px; border-top: 2px solid var(--neon-green); border-left: 2px solid var(--neon-green); }
  .hud-corner.tr { top: 20px; right: 20px; border-top: 2px solid var(--neon-green); border-right: 2px solid var(--neon-green); }
  .hud-corner.bl { bottom: 20px; left: 20px; border-bottom: 2px solid var(--neon-green); border-left: 2px solid var(--neon-green); }
  .hud-corner.br { bottom: 20px; right: 20px; border-bottom: 2px solid var(--neon-green); border-right: 2px solid var(--neon-green); }

  /* Status bar */
  .status-bar {
    position: fixed;
    top: 0; left: 0; right: 0;
    height: 32px;
    background: rgba(0,255,136,0.05);
    border-bottom: 1px solid var(--border);
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 0 20px;
    font-size: 10px;
    color: var(--dim);
    z-index: 100;
    letter-spacing: 2px;
  }
  .status-bar .live {
    display: flex;
    align-items: center;
    gap: 6px;
    color: var(--neon-red);
  }
  .pulse-dot {
    width: 6px; height: 6px;
    border-radius: 50%;
    background: var(--neon-red);
    animation: pulse 1s infinite;
  }
  @keyframes pulse { 0%,100%{opacity:1;transform:scale(1)} 50%{opacity:0.3;transform:scale(0.7)} }

  /* Main container */
  .container {
    position: relative;
    z-index: 10;
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 60px 20px 20px;
  }

  /* Header */
  .logo {
    text-align: center;
    margin-bottom: 8px;
  }
  .logo-main {
    font-family: 'Orbitron', monospace;
    font-size: clamp(28px, 5vw, 52px);
    font-weight: 900;
    color: var(--neon-green);
    text-shadow:
      0 0 10px rgba(0,255,136,0.8),
      0 0 30px rgba(0,255,136,0.4),
      0 0 80px rgba(0,255,136,0.2);
    letter-spacing: 8px;
    animation: glow-flicker 4s infinite;
  }
  @keyframes glow-flicker {
    0%,95%,100%{opacity:1}
    96%{opacity:0.8}
    97%{opacity:1}
    98%{opacity:0.6}
    99%{opacity:1}
  }
  .logo-sub {
    font-size: 11px;
    letter-spacing: 6px;
    color: var(--dim);
    margin-top: 4px;
  }
  .vs-badge {
    display: inline-flex;
    align-items: center;
    gap: 16px;
    margin: 14px 0;
    font-family: 'Orbitron', monospace;
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 3px;
  }
  .vs-badge .dev { color: var(--neon-blue); text-shadow: 0 0 12px rgba(0,212,255,0.6); }
  .vs-badge .att { color: var(--neon-red); text-shadow: 0 0 12px rgba(255,0,60,0.6); }
  .vs-badge .vs { color: var(--neon-yellow); font-size: 16px; text-shadow: 0 0 12px rgba(255,230,0,0.6); }

  /* Security score */
  .security-meter {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 24px;
    font-size: 10px;
    letter-spacing: 2px;
    color: var(--dim);
  }
  .meter-bar {
    display: flex;
    gap: 3px;
  }
  .meter-seg {
    width: 18px; height: 8px;
    background: var(--neon-green);
    box-shadow: 0 0 8px rgba(0,255,136,0.6);
    animation: meter-anim 0.5s ease both;
  }
  .meter-seg:nth-child(n+9) { background: var(--neon-yellow); box-shadow: 0 0 8px rgba(255,230,0,0.5); }
  .meter-seg:nth-child(10) { background: var(--neon-green); }
  @keyframes meter-anim { from{opacity:0;transform:scaleY(0)} to{opacity:1;transform:scaleY(1)} }
  .meter-seg:nth-child(1){animation-delay:0.05s}
  .meter-seg:nth-child(2){animation-delay:0.1s}
  .meter-seg:nth-child(3){animation-delay:0.15s}
  .meter-seg:nth-child(4){animation-delay:0.2s}
  .meter-seg:nth-child(5){animation-delay:0.25s}
  .meter-seg:nth-child(6){animation-delay:0.3s}
  .meter-seg:nth-child(7){animation-delay:0.35s}
  .meter-seg:nth-child(8){animation-delay:0.4s}
  .meter-seg:nth-child(9){animation-delay:0.45s}
  .meter-seg:nth-child(10){animation-delay:0.5s}

  /* Login panel */
  .login-panel {
    width: 100%;
    max-width: 480px;
    background: var(--bg-panel);
    border: 1px solid var(--border);
    position: relative;
    padding: 36px 40px;
    animation: panel-in 0.6s cubic-bezier(0.22,1,0.36,1) both;
    box-shadow:
      0 0 60px rgba(0,255,136,0.05),
      inset 0 0 60px rgba(0,0,0,0.5);
  }
  @keyframes panel-in { from{opacity:0;transform:translateY(20px)} to{opacity:1;transform:translateY(0)} }

  /* Panel corner accents */
  .login-panel::before, .login-panel::after {
    content: '';
    position: absolute;
    width: 20px; height: 20px;
  }
  .login-panel::before {
    top: -1px; left: -1px;
    border-top: 2px solid var(--neon-green);
    border-left: 2px solid var(--neon-green);
  }
  .login-panel::after {
    bottom: -1px; right: -1px;
    border-bottom: 2px solid var(--neon-green);
    border-right: 2px solid var(--neon-green);
  }

  .panel-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 28px;
    padding-bottom: 16px;
    border-bottom: 1px solid var(--border);
  }
  .panel-title {
    font-size: 11px;
    letter-spacing: 4px;
    color: var(--neon-green);
  }
  .panel-code {
    font-size: 9px;
    color: var(--dim);
    letter-spacing: 2px;
  }

  /* Role selector */
  .role-selector {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 8px;
    margin-bottom: 24px;
  }
  .role-btn {
    padding: 10px;
    background: transparent;
    border: 1px solid rgba(255,255,255,0.1);
    color: var(--dim);
    font-family: 'Share Tech Mono', monospace;
    font-size: 10px;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.2s;
    text-transform: uppercase;
  }
  .role-btn:hover { border-color: var(--neon-green); color: var(--neon-green); background: rgba(0,255,136,0.05); }
  .role-btn.active-dev {
    border-color: var(--neon-blue);
    color: var(--neon-blue);
    background: rgba(0,212,255,0.08);
    box-shadow: 0 0 20px rgba(0,212,255,0.2);
  }
  .role-btn.active-att {
    border-color: var(--neon-red);
    color: var(--neon-red);
    background: rgba(255,0,60,0.08);
    box-shadow: 0 0 20px rgba(255,0,60,0.2);
  }

  /* Form fields */
  .field-group { margin-bottom: 18px; position: relative; }
  .field-label {
    display: block;
    font-size: 9px;
    letter-spacing: 3px;
    color: var(--dim);
    margin-bottom: 8px;
    text-transform: uppercase;
  }
  .field-input {
    width: 100%;
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(0,255,136,0.15);
    border-top: none;
    border-left: none;
    border-right: none;
    border-bottom: 1px solid rgba(0,255,136,0.3);
    color: var(--neon-green);
    font-family: 'Share Tech Mono', monospace;
    font-size: 14px;
    padding: 10px 40px 10px 12px;
    outline: none;
    transition: all 0.2s;
    caret-color: var(--neon-green);
  }
  .field-input::placeholder { color: rgba(0,255,136,0.2); font-size: 11px; letter-spacing: 2px; }
  .field-input:focus {
    border-bottom-color: var(--neon-green);
    background: rgba(0,255,136,0.03);
    box-shadow: 0 4px 20px rgba(0,255,136,0.1);
  }
  .field-icon {
    position: absolute;
    right: 12px;
    bottom: 11px;
    font-size: 14px;
    color: var(--dim);
    transition: color 0.2s;
    cursor: pointer;
    user-select: none;
  }
  .field-input:focus ~ .field-icon { color: var(--neon-green); }

  /* Strength bar */
  .strength-bar {
    display: flex;
    gap: 4px;
    margin-top: 8px;
  }
  .strength-seg {
    height: 3px;
    flex: 1;
    background: rgba(255,255,255,0.1);
    transition: background 0.3s, box-shadow 0.3s;
  }

  /* MFA Section */
  .mfa-section {
    margin-bottom: 18px;
  }
  .mfa-label {
    font-size: 9px;
    letter-spacing: 3px;
    color: var(--dim);
    margin-bottom: 10px;
    display: block;
  }
  .mfa-digits {
    display: flex;
    gap: 8px;
    justify-content: center;
  }
  .mfa-digit {
    width: 44px; height: 52px;
    background: rgba(0,0,0,0.4);
    border: 1px solid rgba(0,255,136,0.15);
    color: var(--neon-green);
    font-family: 'Orbitron', monospace;
    font-size: 20px;
    font-weight: 700;
    text-align: center;
    outline: none;
    transition: all 0.2s;
    caret-color: transparent;
  }
  .mfa-digit:focus {
    border-color: var(--neon-green);
    box-shadow: 0 0 20px rgba(0,255,136,0.2);
    background: rgba(0,255,136,0.05);
  }

  /* Captcha */
  .captcha-section {
    margin-bottom: 22px;
    border: 1px solid var(--border);
    padding: 12px 16px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    background: rgba(0,0,0,0.3);
  }
  .captcha-challenge {
    font-size: 11px;
    color: var(--dim);
    letter-spacing: 1px;
  }
  .captcha-answer {
    background: transparent;
    border: none;
    border-bottom: 1px solid var(--border);
    width: 80px;
    color: var(--neon-green);
    font-family: 'Share Tech Mono', monospace;
    font-size: 14px;
    text-align: center;
    outline: none;
    padding: 4px;
  }

  /* Submit */
  .submit-btn {
    width: 100%;
    padding: 14px;
    background: transparent;
    border: 1px solid var(--neon-green);
    color: var(--neon-green);
    font-family: 'Orbitron', monospace;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 6px;
    text-transform: uppercase;
    cursor: pointer;
    position: relative;
    overflow: hidden;
    transition: all 0.3s;
    margin-bottom: 16px;
    box-shadow: 0 0 20px rgba(0,255,136,0.1);
  }
  .submit-btn::before {
    content: '';
    position: absolute;
    top: 0; left: -100%;
    width: 100%; height: 100%;
    background: linear-gradient(90deg, transparent, rgba(0,255,136,0.1), transparent);
    transition: left 0.4s;
  }
  .submit-btn:hover::before { left: 100%; }
  .submit-btn:hover {
    background: rgba(0,255,136,0.08);
    box-shadow: 0 0 40px rgba(0,255,136,0.3);
    text-shadow: 0 0 10px rgba(0,255,136,0.5);
  }
  .submit-btn:active { transform: scale(0.99); }
  .submit-btn.loading { pointer-events: none; opacity: 0.7; }
  .submit-btn.attacker-mode {
    border-color: var(--neon-red);
    color: var(--neon-red);
    box-shadow: 0 0 20px rgba(255,0,60,0.1);
  }
  .submit-btn.attacker-mode:hover { background: rgba(255,0,60,0.08); box-shadow: 0 0 40px rgba(255,0,60,0.3); }

  /* Footer info */
  .panel-footer {
    display: flex;
    justify-content: space-between;
    font-size: 9px;
    color: var(--dim);
    letter-spacing: 1px;
    margin-top: 4px;
  }
  .panel-footer a {
    color: var(--dim);
    text-decoration: none;
    transition: color 0.2s;
  }
  .panel-footer a:hover { color: var(--neon-green); }

  /* Threat feed */
  .threat-feed {
    margin-top: 20px;
    width: 100%;
    max-width: 480px;
    font-size: 9px;
    letter-spacing: 1px;
  }
  .threat-feed-title {
    color: var(--dim);
    letter-spacing: 3px;
    margin-bottom: 8px;
    font-size: 9px;
  }
  .threat-item {
    display: flex;
    align-items: center;
    gap: 10px;
    padding: 6px 0;
    border-bottom: 1px solid rgba(255,255,255,0.04);
    animation: feed-slide-in 0.3s ease both;
    overflow: hidden;
  }
  @keyframes feed-slide-in { from{opacity:0;transform:translateX(-10px)} to{opacity:1;transform:translateX(0)} }
  .threat-dot { width: 6px; height: 6px; border-radius: 50%; flex-shrink: 0; }
  .dot-red { background: var(--neon-red); box-shadow: 0 0 6px rgba(255,0,60,0.6); }
  .dot-green { background: var(--neon-green); box-shadow: 0 0 6px rgba(0,255,136,0.6); }
  .dot-yellow { background: var(--neon-yellow); box-shadow: 0 0 6px rgba(255,230,0,0.6); }
  .threat-text { color: var(--dim); flex: 1; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .threat-time { color: rgba(255,255,255,0.15); flex-shrink: 0; }

  /* Alert box */
  .alert-box {
    display: none;
    padding: 10px 14px;
    margin-bottom: 16px;
    font-size: 10px;
    letter-spacing: 1px;
    border-left: 3px solid var(--neon-red);
    background: rgba(255,0,60,0.08);
    color: var(--neon-red);
    animation: alert-in 0.3s ease;
  }
  @keyframes alert-in { from{opacity:0;transform:translateX(-5px)} to{opacity:1;transform:translateX(0)} }
  .alert-box.show { display: block; }

  /* Success */
  .success-overlay {
    display: none;
    position: fixed;
    top: 0; left: 0; right: 0; bottom: 0;
    z-index: 9000;
    background: rgba(0,0,0,0.95);
    align-items: center;
    justify-content: center;
    flex-direction: column;
    text-align: center;
  }
  .success-overlay.show { display: flex; animation: success-in 0.5s ease; }
  @keyframes success-in { from{opacity:0} to{opacity:1} }
  .success-icon { font-size: 64px; margin-bottom: 20px; animation: spin-in 0.6s cubic-bezier(0.22,1,0.36,1); }
  @keyframes spin-in { from{transform:scale(0) rotate(-180deg)} to{transform:scale(1) rotate(0)} }
  .success-title {
    font-family: 'Orbitron', monospace;
    font-size: 28px;
    font-weight: 900;
    letter-spacing: 6px;
    margin-bottom: 10px;
  }
  .success-title.dev-success { color: var(--neon-blue); text-shadow: 0 0 20px rgba(0,212,255,0.5); }
  .success-title.att-success { color: var(--neon-red); text-shadow: 0 0 20px rgba(255,0,60,0.5); }
  .success-sub { color: var(--dim); font-size: 11px; letter-spacing: 3px; }
</style>
</head>
<body>

<canvas id="matrix-canvas"></canvas>
<div class="vignette"></div>
<div class="hud-corner tl"></div>
<div class="hud-corner tr"></div>
<div class="hud-corner bl"></div>
<div class="hud-corner br"></div>

<div class="status-bar">
  <div class="live"><div class="pulse-dot"></div>LIVE COMPETITION</div>
  <span id="clock">00:00:00</span>
  <span id="ip-display">IP: ---.---.---.---</span>
  <span>ENCRYPTION: AES-256-GCM</span>
  <span id="attempts-display">ATTEMPTS REMAINING: 5</span>
</div>

<div class="container">
  <div class="logo">
    <div class="logo-main">FORTRESS</div>
    <div class="logo-sub">CAPTURE THE FLAG // AUTHENTICATION CHALLENGE</div>
  </div>

  <div class="vs-badge">
    <span class="dev">[ DEFENDERS ]</span>
    <span class="vs">âš”</span>
    <span class="att">[ ATTACKERS ]</span>
  </div>

  <div class="security-meter">
    <span>SEC LVL:</span>
    <div class="meter-bar" id="meter">
      <div class="meter-seg"></div><div class="meter-seg"></div>
      <div class="meter-seg"></div><div class="meter-seg"></div>
      <div class="meter-seg"></div><div class="meter-seg"></div>
      <div class="meter-seg"></div><div class="meter-seg"></div>
      <div class="meter-seg"></div><div class="meter-seg"></div>
    </div>
    <span style="color:var(--neon-green)">MAXIMUM</span>
  </div>

  <div class="login-panel">
    <div class="panel-header">
      <span class="panel-title">// AUTHENTICATION REQUIRED</span>
      <span class="panel-code" id="session-code">SESS: --------</span>
    </div>

    <div class="role-selector">
      <button class="role-btn active-dev" id="btn-dev" onclick="selectRole('dev')">â¬¡ DEFENDER</button>
      <button class="role-btn" id="btn-att" onclick="selectRole('att')">â¬¢ ATTACKER</button>
    </div>

    <div class="alert-box" id="alert-box">âš  ACCESS DENIED â€” INVALID CREDENTIALS</div>

    <div class="field-group">
      <label class="field-label">// USER IDENTIFIER</label>
      <input class="field-input" id="username" type="text" placeholder="ENTER_CALLSIGN" autocomplete="off" spellcheck="false">
      <span class="field-icon" title="Unique identifier">â—‰</span>
    </div>

    <div class="field-group">
      <label class="field-label">// PASSPHRASE [MIN 16 CHARS]</label>
      <input class="field-input" id="password" type="password" placeholder="ENTER_PASSPHRASE" autocomplete="off" oninput="checkStrength(this.value)">
      <span class="field-icon" onclick="togglePassword()" id="eye-icon" title="Toggle visibility">â—Ž</span>
      <div class="strength-bar">
        <div class="strength-seg" id="s1"></div>
        <div class="strength-seg" id="s2"></div>
        <div class="strength-seg" id="s3"></div>
        <div class="strength-seg" id="s4"></div>
        <div class="strength-seg" id="s5"></div>
      </div>
    </div>

    <div class="mfa-section">
      <span class="mfa-label">// HARDWARE TOKEN (6-DIGIT OTP)</span>
      <div class="mfa-digits">
        <input class="mfa-digit" id="otp0" maxlength="1" type="text" pattern="[0-9]" oninput="otpNext(this,0)" onkeydown="otpBack(event,0)">
        <input class="mfa-digit" id="otp1" maxlength="1" type="text" pattern="[0-9]" oninput="otpNext(this,1)" onkeydown="otpBack(event,1)">
        <input class="mfa-digit" id="otp2" maxlength="1" type="text" pattern="[0-9]" oninput="otpNext(this,2)" onkeydown="otpBack(event,2)">
        <input class="mfa-digit" id="otp3" maxlength="1" type="text" pattern="[0-9]" oninput="otpNext(this,3)" onkeydown="otpBack(event,3)">
        <input class="mfa-digit" id="otp4" maxlength="1" type="text" pattern="[0-9]" oninput="otpNext(this,4)" onkeydown="otpBack(event,4)">
        <input class="mfa-digit" id="otp5" maxlength="1" type="text" pattern="[0-9]" oninput="otpNext(this,5)" onkeydown="otpBack(event,5)">
      </div>
    </div>

    <div class="captcha-section">
      <span class="captcha-challenge" id="captcha-text">âš™ LOADING CHALLENGE...</span>
      <input class="captcha-answer" id="captcha-input" placeholder="ANS" autocomplete="off">
    </div>

    <button class="submit-btn" id="submit-btn" onclick="attemptLogin()">
      AUTHENTICATE
    </button>

    <div class="panel-footer">
      <a href="#">FORGOT CREDENTIALS?</a>
      <a href="#">REGISTER TEAM</a>
      <a href="#">RULES & TERMS</a>
    </div>
  </div>

  <div class="threat-feed">
    <div class="threat-feed-title">// LIVE THREAT INTELLIGENCE</div>
    <div id="threat-log"></div>
  </div>
</div>

<!-- Success overlay -->
<div class="success-overlay" id="success-overlay">
  <div class="success-icon" id="success-icon">ðŸ›¡</div>
  <div class="success-title" id="success-title">ACCESS GRANTED</div>
  <div class="success-sub" id="success-sub">WELCOME TO THE ARENA, DEFENDER</div>
</div>

<script>
// === MATRIX RAIN ===
const canvas = document.getElementById('matrix-canvas');
const ctx = canvas.getContext('2d');
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;
const chars = 'ã‚¢ã‚¤ã‚¦ã‚¨ã‚ªã‚«ã‚­ã‚¯ã‚±ã‚³01ã‚¢BCDEFGHIJKLMNOPQRSTUVWXYZ0123456789@#$%^&*><[]{}';
const fontSize = 13;
const cols = Math.floor(canvas.width / fontSize);
const drops = Array(cols).fill(1);
function drawMatrix() {
  ctx.fillStyle = 'rgba(2,4,8,0.05)';
  ctx.fillRect(0, 0, canvas.width, canvas.height);
  ctx.fillStyle = '#00ff88';
  ctx.font = fontSize + 'px monospace';
  for (let i = 0; i < drops.length; i++) {
    const char = chars[Math.floor(Math.random() * chars.length)];
    ctx.fillText(char, i * fontSize, drops[i] * fontSize);
    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) drops[i] = 0;
    drops[i]++;
  }
}
setInterval(drawMatrix, 50);

// === CLOCK ===
function updateClock() {
  const now = new Date();
  const h = String(now.getHours()).padStart(2,'0');
  const m = String(now.getMinutes()).padStart(2,'0');
  const s = String(now.getSeconds()).padStart(2,'0');
  document.getElementById('clock').textContent = h+':'+m+':'+s;
}
setInterval(updateClock, 1000);
updateClock();

// === FAKE IP ===
function randIP() { return Array(4).fill(0).map(()=>Math.floor(Math.random()*256)).join('.'); }
document.getElementById('ip-display').textContent = 'IP: ' + randIP();

// === SESSION CODE ===
function randHex(n) { return [...Array(n)].map(()=>Math.floor(Math.random()*16).toString(16).toUpperCase()).join(''); }
document.getElementById('session-code').textContent = 'SESS: ' + randHex(8);

// === CAPTCHA ===
let captchaAnswer = '';
function genCaptcha() {
  const ops = [['+', (a,b)=>a+b], ['-',(a,b)=>a-b], ['Ã—',(a,b)=>a*b]];
  const [sym, fn] = ops[Math.floor(Math.random()*ops.length)];
  const a = Math.floor(Math.random()*9)+1;
  const b = sym==='Ã—' ? Math.floor(Math.random()*5)+1 : Math.floor(Math.random()*9)+1;
  captchaAnswer = String(fn(a,b));
  document.getElementById('captcha-text').textContent = `âš™ COMPUTE: ${a} ${sym} ${b} = ?`;
  document.getElementById('captcha-input').value = '';
}
genCaptcha();

// === ROLE SELECT ===
let currentRole = 'dev';
function selectRole(role) {
  currentRole = role;
  document.getElementById('btn-dev').className = 'role-btn' + (role==='dev'?' active-dev':'');
  document.getElementById('btn-att').className = 'role-btn' + (role==='att'?' active-att':'');
  const btn = document.getElementById('submit-btn');
  btn.className = 'submit-btn' + (role==='att' ? ' attacker-mode' : '');
}

// === PASSWORD STRENGTH ===
function checkStrength(val) {
  const segs = [document.getElementById('s1'),document.getElementById('s2'),
    document.getElementById('s3'),document.getElementById('s4'),document.getElementById('s5')];
  let score = 0;
  if (val.length >= 8) score++;
  if (val.length >= 16) score++;
  if (/[A-Z]/.test(val) && /[a-z]/.test(val)) score++;
  if (/[0-9]/.test(val)) score++;
  if (/[^A-Za-z0-9]/.test(val)) score++;
  const colors = ['#ff003c','#ff6600','#ffe600','#88ff00','#00ff88'];
  segs.forEach((s,i) => {
    s.style.background = i < score ? colors[score-1] : 'rgba(255,255,255,0.1)';
    s.style.boxShadow = i < score ? `0 0 8px ${colors[score-1]}80` : 'none';
  });
}

// === TOGGLE PASSWORD ===
function togglePassword() {
  const inp = document.getElementById('password');
  inp.type = inp.type === 'password' ? 'text' : 'password';
}

// === OTP NAV ===
function otpNext(el, idx) {
  el.value = el.value.replace(/[^0-9]/g,'');
  if (el.value && idx < 5) document.getElementById('otp'+(idx+1)).focus();
}
function otpBack(e, idx) {
  if (e.key === 'Backspace' && !e.target.value && idx > 0) document.getElementById('otp'+(idx-1)).focus();
}

// === ATTEMPTS ===
let attempts = 5;
function updateAttempts() {
  document.getElementById('attempts-display').textContent = 'ATTEMPTS REMAINING: ' + attempts;
  if (attempts <= 2) document.getElementById('attempts-display').style.color = 'var(--neon-red)';
}

// === LOGIN ===
function getOTP() { return [0,1,2,3,4,5].map(i=>document.getElementById('otp'+i).value).join(''); }

function attemptLogin() {
  const user = document.getElementById('username').value.trim();
  const pass = document.getElementById('password').value;
  const otp = getOTP();
  const cap = document.getElementById('captcha-input').value.trim();
  const alert = document.getElementById('alert-box');

  // Validate all fields
  if (!user || !pass || otp.length < 6 || !cap) {
    alert.textContent = 'âš  ALL FIELDS REQUIRED â€” FILL EVERY SECTOR';
    alert.classList.add('show');
    addThreatLog('red', 'Incomplete submission from session '+randHex(4));
    return;
  }
  if (pass.length < 8) {
    alert.textContent = 'âš  PASSPHRASE TOO WEAK â€” MINIMUM 8 CHARACTERS';
    alert.classList.add('show');
    return;
  }
  if (cap !== captchaAnswer) {
    attempts--;
    updateAttempts();
    alert.textContent = `âš  CAPTCHA FAILED â€” ${attempts} ATTEMPTS REMAINING`;
    alert.classList.add('show');
    addThreatLog('red', 'Failed CAPTCHA from IP ' + randIP());
    genCaptcha();
    if (attempts <= 0) lockout();
    return;
  }

  // Success â€” demo accepts any valid input
  alert.classList.remove('show');
  const btn = document.getElementById('submit-btn');
  btn.textContent = 'AUTHENTICATING...';
  btn.classList.add('loading');
  addThreatLog('green', (currentRole==='dev'?'DEFENDER':'ATTACKER') + ' ' + user + ' authenticated successfully');

  setTimeout(() => {
    const overlay = document.getElementById('success-overlay');
    const title = document.getElementById('success-title');
    const sub = document.getElementById('success-sub');
    const icon = document.getElementById('success-icon');
    if (currentRole === 'dev') {
      title.className = 'success-title dev-success';
      title.textContent = 'ACCESS GRANTED';
      sub.textContent = 'WELCOME TO THE ARENA, DEFENDER // LOADING DASHBOARD';
      icon.textContent = 'ðŸ›¡';
    } else {
      title.className = 'success-title att-success';
      title.textContent = 'BREACH INITIATED';
      sub.textContent = 'WELCOME, ATTACKER // COMMENCE OPERATIONS';
      icon.textContent = 'ðŸ’€';
    }
    overlay.classList.add('show');
  }, 1800);
}

function lockout() {
  document.getElementById('submit-btn').disabled = true;
  document.getElementById('submit-btn').textContent = 'LOCKED OUT';
  document.getElementById('alert-box').textContent = 'ðŸ”’ ACCOUNT LOCKED â€” SECURITY TEAM NOTIFIED';
  addThreatLog('red', 'CRITICAL: Account locked after max attempts. IP: '+randIP());
}

// === THREAT FEED ===
const threats = [
  ['red', 'Brute force attempt detected from {IP}'],
  ['yellow', 'SQL injection probe blocked on auth endpoint'],
  ['red', 'Credential stuffing attack â€” {IP} â€” 1,200 req/min'],
  ['green', 'DEFENDER authenticated: callsign GHOST_1337'],
  ['yellow', 'Rate limit triggered for subnet 192.168.{r}.0/24'],
  ['red', 'XSS payload intercepted in username field'],
  ['green', 'JWT token issued to DEFENDER NOVA_SEC'],
  ['red', 'Replay attack detected â€” token blacklisted'],
  ['yellow', 'Anomalous geolocation: {IP} flagged'],
  ['green', 'ATTACKER SHADOW_9 authenticated â€” ops initiated'],
  ['red', 'CSRF token mismatch â€” request blocked'],
  ['yellow', 'Certificate transparency log scanned by unknown bot'],
];

function addThreatLog(color, text) {
  text = text.replace('{IP}', randIP()).replace('{r}', Math.floor(Math.random()*255));
  const log = document.getElementById('threat-log');
  const item = document.createElement('div');
  item.className = 'threat-item';
  const now = new Date();
  item.innerHTML = `
    <div class="threat-dot dot-${color}"></div>
    <span class="threat-text">${text}</span>
    <span class="threat-time">${String(now.getHours()).padStart(2,'0')}:${String(now.getMinutes()).padStart(2,'0')}:${String(now.getSeconds()).padStart(2,'0')}</span>
  `;
  log.insertBefore(item, log.firstChild);
  if (log.children.length > 5) log.removeChild(log.lastChild);
}

// Auto-populate threat feed
function autoThreat() {
  const [color, text] = threats[Math.floor(Math.random() * threats.length)];
  addThreatLog(color, text);
}
setTimeout(autoThreat, 1000);
setTimeout(autoThreat, 2500);
setTimeout(autoThreat, 4000);
setInterval(autoThreat, Math.random()*3000 + 4000);

// Initialize
window.addEventListener('resize', () => {
  canvas.width = window.innerWidth;
  canvas.height = window.innerHeight;
});
</script>
</body>
</html>